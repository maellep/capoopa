<!DOCTYPE html> 
<html> 
<head> 
  <title>Capoopa</title> 
  
  <meta name="viewport" content="width=device-width, initial-scale=1"> 
  <meta http-equiv="Content-Type" content="text/ html; charset=UTF-8" />

  <link rel="stylesheet" href="css/main.css" />
  <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
  <script src="lib/jquery-1.8.2.min.js"></script>
  <script src="cordova-2.2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
  <script src="lib/handlebars.js"></script>
  <script src="js/capture.js"></script>

<script type="text/javascript" charset="utf-8">

    // Appel lorsque l operation d enregistrement est terminee
    //
    function captureSuccess(mediaFiles) {
        var i, len;
        for (i = 0, len = mediaFiles.length; i < len; i += 1) {
            uploadFile(mediaFiles[i]);
        }       
    }

    // Appel en cas d'erreur.
    // 
    function captureError(error) {
        var msg = 'Une erreur est survenue pendant l enregistrement : ' + error.code;
        navigator.notification.alert(msg, null, 'Aie aie aie !');
    }

    // Un bouton declenchera l appel de cette fonction
    //
    function captureImage() {
        // Lancer l'application appareil photo du mobile, 
        // permettant a l utilisateur de prendre jusqu a 2 photos
        navigator.device.capture.captureImage(captureSuccess, captureError, {limit: 2});
    }

    // Transferer les fichiers vers le serveur
    function uploadFile(mediaFile) {
        var ft = new FileTransfer(),
            path = mediaFile.fullPath,
            name = mediaFile.name;

        ft.upload(path,
            "http://capoopa.alwaysdata.net/upload.php",
            function(result) {
                console.log('Reussite du transfert : ' + result.responseCode);
                console.log(result.bytesSent + ' octets envoyes');
            },
            function(error) {
                console.log('Erreur lors du transfert du fichier ' + path + ' : ' + error.code);
            },
            { fileName: name });   
    }

    </script>
</head> 
<body>

  <div class="page" data-type="answer">

    <button onclick="captureImage();">Capture Image</button> <br/>
          
    <!-- C est soit l un soit l autre -->
      <form  action="#" id="form1">
        <p>
          <img id="myImage" src="" width="100%" style="display:none" />
          <input type="button" onclick="capturePhoto();" value="Joindre une photo"  />
          <input type="button" onclick="deletePhoto();" value="Supprimer la photo" />
          <input type="button" onclick="sendform();"  value="Envoyer"  />
        </p>
      </form>

  </div>


</body>
</html>